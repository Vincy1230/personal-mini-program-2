> 人工智能 212 史胤隆 2006010529
>
> 完整代码参见 [Vincy 云昔/个人微信小程序-老八食肆 (gitee.com)](https://gitee.com/Vincy1230/personal-mini-program-2)

### 一、导航栏的实现

| 程序首页                                                                        | 点单页面                                                                        | 个人主页                                                                        |
| ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| ![01](https://foruda.gitee.com/images/1726341037418095464/060db6d1_8768241.png) | ![02](https://foruda.gitee.com/images/1726341048884530202/28498219_8768241.png) | ![03](https://foruda.gitee.com/images/1726341062972657395/fe4aca71_8768241.png) |

##### 附 1：涉及 Tab Bar 页面的特殊导航规则

当两个页面同属于 Tab Bar 成员时，一般的导航并不适用，以避免反复切换导致页面历史炸栈。因此，两者之间的导航按钮 (如上图 1 种的 `点我下单` )

微信小程序给出了组件式和接口式两种替代的导航方式。

```xml
<navigator class="go-order" url="../order/order" open-type="switchTab">
    ...
</navigator>
```

```javascript
goOrderTap() {
    wx.switchTab({
        url: '/pages/order/order',
    });
    ...
}
```

##### 附 2：页面加载时机与音频响应

第一，在尝试按钮音频响应的时候发现 `createInnerAudioContext` 其实是可以很早完成的；第二，音频和页面并没有强隶属，只要 `AudioContext` 存活音频播放就能持续。于是“拖尾音效”得以实现：

```javascript
{
    onLoad(query) {
        this.start_order = wx.createInnerAudioContext({
            useWebAudioImplement: true,
        });
        this.start_order.src = 'audios/start_order.mp3';
    },

    goOrderTap() {
        wx.switchTab({
            url: '/pages/order/order',
        });  // 此时页面已切出
        this.start_order.play();  // 音频仍会持续
    },
}
```

当然，这也带来了一些隐患——例如大音频依赖显式析构，否则有内存泄露风险。

### 二、滚动轮播 banner 的实现

| 滚动 1                                                                          | 滚动 2                                                                          | 滚动 3                                                                          | 滚动 4                                                                          | 滚动 5                                                                          |
| ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| ![01](https://foruda.gitee.com/images/1726341179842970965/973cefdb_8768241.png) | ![04](https://foruda.gitee.com/images/1726341192462299498/394503f0_8768241.png) | ![05](https://foruda.gitee.com/images/1726341200217068985/2cbad5aa_8768241.png) | ![06](https://foruda.gitee.com/images/1726341229182235680/eb8c6767_8768241.png) | ![07](https://foruda.gitee.com/images/1726341247436835132/fb9bce6c_8768241.png) |

##### 附 3：swiper 不止是滚动图

swiper 和 swiper-item 可以是任何内容。例如本实验此处添加了文本注释栏。

##### 附 4：利用 wx:for 处理重复的格式内容

swiper 本质上也是一种抽象的超文本列表。这类内容如果摊开写会很难维护，因此微信小程序 / Vue 等框架都会有对这类结构的优化。

```xml
<swiper indicator-dots="true" indicator-active-color="#6F4017" autoplay="true" interval="3000" duration="300" circular="true">
    <swiper-item wx:for="{{swpList}}" wx:key="*this">
        <image class="swp-img" src="{{item.img}}" mode="aspectFill"></image>
        <view class="swp-text">{{item.text}}</view>
    </swiper-item>
</swiper>
```

当然，这类结构也能嵌套。

```xml
<view class="category" wx:for="{{category}}" wx:for-item="categoryItem" wx:key="*this">
    <view class="category-title">{{categoryItem.name}}</view>
    <view class="dishes" wx:for="{{categoryItem.dishes}}" wx:for-item="dishesItem" wx:key="*this">
        <view class="dishes-part">
            <image class="dishes-pic" src="{{dishesItem.pic}}"></image>
            <view class="dishes-info">
                <view class="dishes-name">{{dishesItem.name}}</view>
                <view class="dishes-price">{{dishesItem.price}} 元 / {{dishesItem.unit}}</view>
            </view>
        </view>
        <view class="dishes-part">
            <view class="dishes-count">
                <view class="count-btn" bindtap="minus" data-index="{{dishesItem.index}}">-</view>
                <text class="count-number">{{dishesItem.count}}</text>
                <view class="count-btn" bindtap="add" data-index="{{dishesItem.index}}">+</view>
            </view>
        </view>
    </view>
</view>
```
